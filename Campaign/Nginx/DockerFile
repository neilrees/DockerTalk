FROM microsoft/windowsservercore:1709
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop';"]

EXPOSE 80 443
ENV NGINX_VERSION 1.11.6

RUN Add-Type -AssemblyName System.IO.Compression.FileSystem ; \
    Invoke-WebRequest -outfile nginx.zip "http://nginx.org/download/nginx-$($env:NGINX_VERSION).zip; \
    [System.IO.Compression.ZipFile]::ExtractToDirectory('nginx.zip', 'c:\'); \
    Rename-Item "nginx-$($env:NGINX_VERSION)" nginx; \
    Remove-Item nginx.zip

WORKDIR c:/nginx
COPY nginx.conf ./conf/
COPY passwd ./conf/

CMD .\nginx